import React, { useContext, useState } from 'react'
import axios from 'axios'
import toast from 'react-hot-toast'
import { AppContext } from '../../context/AppContext'

const Login = () => {

  const { backendUrl } = useContext(AppContext);
  const [email,setEmail]=useState('')
  const [password,setPassword]=useState('')
  const [error, setError] = useState('')

  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e)=>{
    e.preventDefault();
    try {
      setLoading(true);
      let response = await axios.post(`${backendUrl}/api/user/admin-login`, {email,password},{withCredentials: true})
      if(response.data.success) {
        localStorage.setItem('token', response.data.token);
        axios.defaults.headers.common['Authorization'] = response.data.token;
        toast.success(response.data.messege);
        setLoading(false);
        setTimeout(()=>{
          window.location.reload()
        },1000)
      }
      setLoading(false);
    } catch (error) {
      setLoading(false);
      console.log(error)
      setError(error.response.data.messege)
    }
  }
  
  return (
    <div className='flex items-center justify-center h-screen bg-[#f1f1f1]'>
      <div className='w-full max-w-md p-6 max-md:m-4 border border-gray-300 rounded-lg bg-white'>
        <div className='flex flex-col items-center justify-center'>
          <div className='w-full mb-4 text-center text-gray-800'>
              <h3 className='text-2xl font-bold' style={{fontFamily:'Outfit'}}><span className='text-[#994CF5]'>Admin </span>Login</h3>
              <p className='leading-none mt-1 sm:text-sm text-xs'>Enter your credientials to access the admin panel</p>
          </div>
          <div className='sm:text-sm text-xs text-gray-800'>
            <p className='text-[#994CF5] font-medium'>Admin Email: <span className='text-gray-800 font-normal' style={{fontFamily: 'Outfit'}}>abdulnoorwork@gmail.com</span></p>
            <p className='text-[#994CF5] font-medium'>Admin Password: <span className='text-gray-800 font-normal' style={{fontFamily: 'Outfit'}}>toxd egor wsfl ovjv</span></p>
          </div>
          <form onSubmit={handleSubmit} className='w-full mt-5 sm:max-w-md text-sm text-gray-700'>
            <p className='text-red-500'>{error ? error : null}</p>
            <input type="email" value={email} onChange={(e)=>setEmail(e.target.value)} placeholder='your email id' className='w-full border border-gray-300 bg-[#f1f1f1] p-2.5 outline-none mb-6' required />
            <input type="password" value={password} onChange={(e)=>setPassword(e.target.value)} placeholder='your password' className='w-full border border-gray-300 bg-[#f1f1f1] p-2.5 outline-none mb-6' required />
            <button type="submit" className='w-full py-3 font-medium bg-[#994CF5] text-white rounded cursor-pointer text-sm sm:text-[15px] hover:bg-gray-800 transition-all'>{loading ? 'loading...' : 'Login'}</button>
          </form>
        </div>
      </div>
    </div>
  )
}

export default Login